/* Compression: uglifyjs -c 'warnings,unused=false,keep_fnames=true,keep_fargs=true' -b 'beautify=false,max-line-len=80' */
"use strict";!function($){var State=function($){var self=this,_init,_={cookieDomain:"",
cookiePath:"/",cookieSecure:!1,cookieNamespace:"",pageRespNo:void 0,prolong:0,checkFirst:6e4,
checkInterval:0,lastCheckTime:null,sessWarnTimeout:0,sessTimeout:0,sessExpireTime:null,
sessWarnTime:null,sessCurrent:!0,sessExpired:!1,sessProlongedTime:null,activitySensed:!1,
revive:!1,formExpireTime:null,formWarnTime:null,formExpired:!1,autoRedirect:!1,redirectTarget:"",
sid:void 0,errors:[],infoCurrent:"",infoLife:6e4},_jqUiDial,_localEn,_errorHandler,_local,_o,_check,_ajax,_ajaxCompleted,_url,_redirect,_info;
_errorHandler=function(error,variable,options){var u=options,o={},t;"function"==typeof window.inspect&&inspect.tcepsni&&("function"==typeof inspect.errorHandler?(u&&("string"==(t=typeof u)?o.message=u:"object"===t&&(o=u)),
o.category="State",inspect.errorHandler(error,variable,o)):inspect.console("Please update Inspect."));
},_local=function(nm){var s;if(!(s=_o(_localEn,nm)))switch(nm){case"preExpire":s=Drupal.t("This page is about to expire!newline!newlinePlease save now, if you have made any changes.!newlineOtherwise, please !link_startreload the page!link_end.");
break;case"expired_redirect":s=Drupal.t("This page has expired!newline!newlinePlease !link_startproceed to the start page!link_end.");
break;case"expired_reload":s=Drupal.t("This page has expired!newline!newlinePlease !link_startreload the page!link_end.");
break;default:s="[LOCAL: "+nm+"]"}return s.replace(/\!newline/g,"\n")},_o=function(o,k0,k1){
var t=typeof o;return o&&("object"===t||"function"===t)&&o.hasOwnProperty(k0)?void 0===k1?o[k0]:(o=o[k0])&&("object"==(t=typeof o)||"function"===t)&&o.hasOwnProperty(k1)?o[k1]:void 0:void 0;
},_check=function(evt,action){var u,u1,d,to,act=action,ci,f;if(_.sessCurrent||_.sessExpired||_.formExpired){
if(d=_.lastCheckTime=new Date,!(_.sessCurrent=_.sid===self.cookieGet("state__sid")))return _.sessCurrent=!1,
_info("expired"),void(_.autoRedirect&&_redirect(_url(),_.infoLife));if("getTimeout"===action)2===_.prolong&&($(document.documentElement).bind("click mousemove keyup",f=function(){
_.activitySensed=!0,_.revive&&(_.revive=!1,new Date<_.formWarnTime&&_check(null,"check"));
}),$(window).scroll(f));else if("check"===action){if((u=self.cookieGet("state__ssprlngd"))&&u&&(u=u.split(","),
2===u.length&&u[1]===_.sid&&/^\d{13,14}$/.test(u[0])&&(u=parseInt(u[0],10))&&(u1=new Date(u))&&u1>_.sessProlongedTime&&(_.sessProlongedTime=u1,
_.sessExpireTime=new Date(u+_.sessTimeout),_.sessWarnTime=new Date(u+_.sessWarnTimeout))),
ci=_.checkInterval,d>=_.sessExpireTime)return _.sessExpired=!0,_info("expired"),to=setTimeout(function(){
_.sid===self.cookieGet("state__sid")&&_ajax("destroySession")},ci=Math.floor(ci/2)),
void(_.autoRedirect&&_redirect(_url(),ci+_.infoLife));if((u=_.formExpireTime)&&d>=u)return _.formExpired=!0,
_info("expired"),void(_.autoRedirect&&_redirect(_url(),_.infoLife));switch((u=_.formWarnTime)&&d>=u&&"preExpire_form"!==_.infoCurrent&&_info("preExpire_form"),
act=null,_.prolong){case 3:act="prolong";break;case 2:_.activitySensed&&(_.activitySensed=!1,
"preExpire_sess"===_.infoCurrent&&_info(),act="prolong")}if((u=_.sessProlongedTime)&&u.getTime()>d.getTime()-.8*ci&&(act="skip",
ci=Math.floor(.6*ci+(Math.random()*(.4*ci+1)+1)-1)),((u=new Date(d.getTime()+ci))>_.sessExpireTime||u>_.formExpireTime)&&(ci=Math.floor(ci/2)),
to=setTimeout(function(){_check(null,"check")},ci),!act)return void(!_.infoCurrent&&d>=_.sessWarnTime&&(_info("preExpire_sess"),
2===_.prolong&&(_.revive=!0)))}("prolong"===act||"getTimeout"===act)&&_ajax(act)}
},_ajax=function(act){$.ajax({url:Drupal.settings.basePath+"state/ajax/"+_.pageRespNo,
type:"POST",data:{action:act,arg:"destroySession"!==act?null:_.sid},dataType:"json",
cache:!1,success:function(oResp,textStatus,jqXHR){var u,d,t,st,sw,ci,to,to1;if("success"===textStatus&&"object"===$.type(oResp))if(oResp.success){
if("destroySession"===oResp.action||!_.sessCurrent||_.sessExpired)return;if(_.sid!==self.cookieGet("state__sid"))return _.sessCurrent=!1,
_info("expired"),void(_.autoRedirect&&_redirect(url(),_.infoLife));switch(t=(d=new Date).getTime(),
oResp.action){case"prolong":_.sessExpireTime=new Date(t+_.sessTimeout),_.sessWarnTime=new Date(t+_.sessWarnTimeout);
break;case"getTimeout":(st=oResp.sessionTimeout)&&(st*=1e3,(ci=_.checkInterval)>st/6&&(_.checkInterval=ci=Math.floor(st/6)),
_.sessTimeout=st-=ci,_.sessExpireTime=new Date(t+st),(sw=Math.floor(st/10))<ci&&(sw=ci),
_.sessWarnTime=new Date(t+(_.sessWarnTimeout=st-sw)),to=setTimeout(function(){_check(null,"check");
},ci),to1=setTimeout(function(){$("body").ajaxComplete(_ajaxCompleted)},1e3));break;
default:try{throw new Error("Unknown action["+oResp.action+"]")}catch(er){_errorHandler(er,null,"State._check()");
}return}_.sessProlongedTime=d,self.cookieSet("state__ssprlngd",""+t+","+_.sid)}else"no_session"===oResp.error?_.sessCurrent=!1:_errorHandler(oResp,null,"State._check()");else _.errors.push("response: "+textStatus),
_errorHandler(null,{textStatus:textStatus,response_data:oResp},"State._check()")},
error:function(jqXHR,textStatus,errorThrown){jqXHR&&403===jqXHR.status?_.sessCurrent=!1:(_.errors.push("response: "+textStatus),
_errorHandler(null,{textStatus:textStatus,errorThrown:errorThrown},"State._check()"));
}})},_ajaxCompleted=function(e,xhr,settings){var u;200===xhr.status&&"string"==typeof(u=_o(settings,"url"))&&-1===u.indexOf("/state/ajax/")&&self.sessionProlonged();
},_url=function(reload){var url,loc=window.location,v;return reload||!(url=_.redirectTarget)?loc.href.replace(/#.*$/,""):"/"===url.charAt(0)?loc.protocol+"//"+loc.hostname+((v=loc.port)?":"+v:"")+url:url;
},_redirect=function(url,delay){var to=setTimeout(function(){window.location.href=url;
},delay||20)},_info=function(type){var ms,url,a,ttl,dial,to;if(_.infoCurrent=type||"",
type&&("expired"===type?(url=_url(),ms=_.redirectTarget?"expired_redirect":"expired_reload"):(url=_url(!0),
ms="preExpire"),ms=_local(ms).replace(/\!link_start/,'<a href="'+(url||"")+'">').replace(/\!link_end/,"</a>")),
_jqUiDial){if(type&&(a=ms.split(/\n\n/),ttl=a[0].replace(/\n/g,"").replace(/\.$/,""),
a.splice(0,1),ms="<p>"+a.join("</p><p>").replace(/\n/g,"<br/>")+"</p>"),dial=document.getElementById("state_info")){
if(!type)return void $(dial).dialog("close");$(dial).dialog("option","title",ttl),
$(dial).html(ms)}else{if(!type)return;document.getElementById("state_info_container")||$(document.body).append('<div id="state_info">'+ms+"</div>"),
dial=document.getElementById("state_info"),$(dial).dialog({stack:!0,modal:!0,autoOpen:!1,
closeOnEscape:"expired"!==type,resizable:!1,position:["center","center"],title:ttl,
buttons:[{text:Drupal.t("OK"),click:"expired"!==type?function(){$(this).dialog("close");
}:function(){}}],beforeClose:function(){_.infoCurrent=""}}),$(dial.parentNode).css("position","fixed").addClass("module-state-dialog-container");
}"expired"===type&&($("a.ui-dialog-titlebar-close","div.module-state-dialog-container").unbind().hide(),
$(dial).dialog("option","buttons",[{text:Drupal.t("OK"),click:function(){_redirect(_url());
}}])),to=setTimeout(function(){$(dial).dialog("open")},5e3)}else type&&alert(ms.replace(/\!link_[a-z]+/g,""));
},this.init=function(cookieDomain,cookiePath,cookieNamespace,pageRespNo,options){
var o=options,u,v,t=(new Date).getTime(),fx;_init||(_init=!0,_.cookieDomain=cookieDomain,
_.cookiePath=cookiePath,_.cookieNamespace=cookieNamespace,_.pageRespNo=pageRespNo,
o&&"object"==typeof o&&(_.sid=_o(o,"sid"))&&(_.formExpireTime=(fx=_o(o,"formExpire"))?new Date(t+1e3*fx):null)&&(_.prolong=(u=_o(o,"prolong"))||0,
_.checkInterval=1e3*((u=_o(o,"checkInterval"))?u:300),_.formWarnTime=fx?new Date(t+900*fx):null,
_.autoRedirect=_o(o,"autoRedirect")?!0:!1,_.redirectTarget=(u=_o(o,"redirectTarget"))?u:"",
_localEn=(u=_o(o,"localEn"))?u:{},_.cookieSecure="https:"===window.location.protocol,
_jqUiDial="function"==typeof _o($,"ui","dialog"),_.prolong&&(t=setTimeout(function(){
_check(null,"getTimeout")},_.checkFirst=(u=_.checkFirst)<(v=_.checkInterval)?u:v))));
},this.cookieDefaults=function(){return{path:_.cookiePath,domain:_.cookieDomain,secure:_.cookieSecure,
namespace:_.cookieNamespace}},this.cookieSet=function(name,value,options){var u=options,v,t,le,n,o={
path:_.cookiePath,domain:_.cookieDomain,secure:_.cookieSecure};u&&((v=_o(u,"expire"))&&("date"==(t=typeof v)||"number"===t&&v>0)&&(o.expire=v),
(v=_o(u,"path"))&&"/"!==(v=$(trim(v)))&&(le=v.length)&&("/"===v.charCodeAt(le-1)&&(v=v.substr(0,le-1),
--le),"/"===o.path?"/"===v.charCodeAt(0)&&(v=v.substr(1)):"/"!==v.charCodeAt(0)&&(v="/"+v),
o.path+=v)),$.cookie(name+_.cookieNamespace,(n=value)||0===n?n:"",o)},this.cookieIncrease=function(name,increment,options){
var u=increment||1,v=$.cookie(name+_.cookieNamespace)||0,a=[u,v],i,n,t,em;try{for(i=0;2>i;i++)if(n=i?v:u)if(em=i?"cookie value":"arg increment",
"string"==(t=typeof n)){if(n.indexOf(".")>-1){if(!isFinite(a[i]=parseFloat(n)))throw new Error(em+"["+n+"] isnt float-like");
}else if(!isFinite(a[i]=parseInt(n,10)))throw new Error(em+"["+n+"] isnt integer-like");
}else if("number"!==t)throw new Error(em+"["+n+"] isnt number|string|falsy");return self.cookieSet(name,a[1]+=a[0],options),
a[1]}catch(er){em="State.cookieIncrease()",_errorHandler(er,null,em)}return!1},this.cookieGet=function(name){
return $.cookie(name+_.cookieNamespace)},this.cookieRemove=function(name,options){
var o=options||{},v;return o.expire=new Date(1),v=self.cookieGet(name),self.cookieSet(name,"",o),
v},this.alive=function(){return _.sid?!_.sessCurrent||_.sessExpired||_.formExpired?!1:_.sessCurrent=_.sid===self.cookieGet("state__sid"):void 0;
},this.pageResponseNumber=function(){return _.pageRespNo},this.sessionProlonged=function(date){
return this.alive()?(self.cookieSet("state__ssprlngd",""+(_.sessProlongedTime=date||new Date).getTime()+","+_.sid),
!0):!1},this.inspect=function(){"function"==typeof window.inspect&&inspect.tcepsni===!0&&inspect(_,"State");
},this.testCheck=function(){_.sessTimeout&&"function"==typeof window.inspect&&inspect.tcepsni===!0&&_check("check");
},this.testInfo=function(){var s,to,to1;"function"==typeof window.inspect&&inspect.tcepsni===!0&&(s=_.infoCurrent,
_info("preExpire_sess"),to=setTimeout(function(){_info("preExpire_form")},1e4),to1=setTimeout(function(){
_info("expired")},2e4),_.infoCurrent=s,delete this.testInfo)}};Drupal.State=window.State=new State($);
}(jQuery);
